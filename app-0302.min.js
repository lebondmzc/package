Vue.config.productionTip=!1,Vue.config.lang="zh-CN",Vue.use(vant.Lazyload,{lazyComponent:!0}),Vue.use(vant.Dialog);let loading_idx=-1;new Vue({el:"#app",directives:{decodeImg:{inserted(e){var s=e.dataset.src,t=/web.(.*?)$/.exec(s);if(!t||t.length<2){e.src=s;return}let i=t[1];var r=new XMLHttpRequest;r.open("GET",s,!0),r.responseType="",r.onload=function(){if(200==this.status){var s=b64toBlob(this.response,"image/"+i);e.onload=function(){window.URL.revokeObjectURL(e.src)},e.src=window.URL.createObjectURL(s)}},r.onerror=function(e){console.error("get image error")},r.send()}}},data:{list:[],current:"",itemindex:0,activeClass:-1,mimgurl:"http://pandoss.oss-cn-guangzhou.aliyuncs.com/1_bk.txt",cat:[],banner:[],ds_title:"元(24小时有效)",ds_img:"",ds_duration:0,total:0,hezi:!1,loading:!1,finished:!1,vid:0,msg:"没有更多了",params:{action:"list",f,page:1,row:50,encode:1,hot:0,newMov:0,cid:"",key:"",payed:"",kp:kp,factor:+new Date,openid,a,b},catParam:{limit:910,f,encode:1},dialog:{fav:{status:!1,img:"",url:""},pay:{status:!1,pay:[]},sharewindows:{status:!1,freenums:2,invites:0,films:0,link:"链接获取中..."}}},created(){this.debouncedGetList=debounce(this.doGetList,100)},unmounted(){this.debouncedGetList.cancel()},mounted:function(){this.getCat(),this.getQueryVariable("hezi")>0&&(this.hezi=!0)},methods:{getQueryVariable(e){for(var s=window.location.search.substring(1).split("&"),t=0;t<s.length;t++){var i=s[t].split("=");if(i[0]==e)return i[1]}return!1},setClass:e=>"action"+e.flg,doRate:()=>parseInt(9910*Math.random()+90),switchPayment(e){let s=this;var t=s.dialog.pay.pay;for(let i=0;i<t.length;i++){let r=t[i];2==e?(this.$refs.wx.className="",this.$refs.zfb.className="block active",-1==r.url.indexOf("md=2")&&(s.dialog.pay.pay[i].url=r.url+"&md=2")):(this.$refs.wx.className="block active",this.$refs.zfb.className="",-1!=r.url.indexOf("md=2")&&(s.dialog.pay.pay[i].url=r.url.replace("&md=2","")))}},openShare(){let e=this;e.dialog.sharewindows.status=!0,$.ajax({url:"/index/index/info?openid="+e.params.openid+"&f="+e.params.f+"&wx=",type:"GET",complete:function(e,s){},success:function(s){s=aeDsJson(s),e.dialog.sharewindows.freenums=s.data.invite_reward,e.dialog.sharewindows.invites=s.data.invite_count,e.dialog.sharewindows.films=s.data.reward,e.dialog.sharewindows.link=s.data.link}})},copySharelink(){document.getElementById("sharelink").select(),document.execCommand("Copy"),setTimeout(()=>{this.dialog.sharewindows.status=!1},200),vant.Notify({type:"success",message:"成功复制链接："+this.dialog.sharewindows.link})},linkTo(e){if(layer.msg("请稍后...",{icon:16,time:1e3}),"1"==dy){document.form.action=e,document.form.submit();return}$.ajax({url:e,type:"GET",success:function(e){$("#pay").html(e)}})},sousuoa(e){let s=this;s.params.page=1,s.finished=!1,s.list=[],this.debouncedGetList("-1","")},dingbu(){this.$refs.list.scroller.scrollTop=0},reload(){location.reload()},doCopyUrl(){let e=this;var s=new Clipboard("#doCopyValue");s.on("success",function(t){e.$message.success("复制成功"),s.destroy()}),s.on("error",function(s){e.$message.errot("复制失败"),console.log(s)})},doPay(e,s){let t=this;t.vid=e.id;var i=/web.(.*?)$/.exec(e.img);if(i&&i.length>1){t.ds_img&&(window.URL.revokeObjectURL(t.ds_img),t.ds_img="");var r=i[1],o=new XMLHttpRequest;o.open("GET",e.img,!0),o.responseType="",o.onload=function(){if(200==this.status){var e=b64toBlob(this.response,"image/"+r);t.ds_img=window.URL.createObjectURL(e)}},o.send()}else t.ds_img=e.img;t.ds_title=e.title,t.ds_duration=e.duration;var n=layer.load();$.ajax({url:e.url,type:"GET",data:t.params,complete:function(e,s){layer.close(n)},success:function(s){if(1!=(s=aeDsJson(s)).status){layer.msg("網絡錯誤，請重試!");return}if(1==(e=s.data).pay){if("1"==dy){document.form.action=e.url,document.form.submit();return}window.location.href=e.url;return}pays=[{name:"单片购买  "+e.money+" 元",url:e.url,flg:"dan",money:0}],0==!e.date_fee&&pays.push({name:"包日观看全部 "+e.date_fee+" 元",url:e.date_url,flg:"date_fee",money:0}),0==!e.week_fee&&pays.push({name:"包周观看全部 "+e.week_fee+" 元",url:e.week_url,flg:"week_fee",money:0}),0==!e.month_fee&&pays.push({name:"包月观看全部 "+e.month_fee+" 元",url:e.month_url,flg:"month_fee",money:0}),t.dialog.pay.zfstatus_wx=e.zfstatus_wx,t.dialog.pay.zfstatus_zfb=e.zfstatus_zfb,t.dialog.pay.pay=pays,t.dialog.pay.status=!0,t.dialog.pay.zfstatus_zfb&&t.dialog.pay.zfstatus_wx?(t.dialog.pay.selidx=1,t.dialog.pay.zfstatus=!0):(t.dialog.pay.zfstatus=!1,t.dialog.pay.selidx=2)}})},doGetList(e,s){let t=this;(-1===e||0===e||e||-2===e)&&(t.activeClass=e);let i=!1;if("yigou"==s&&(t.params.page=1,t.params.payed=1,t.params.key="",t.params.cid="",t.params.hot=0,t.params.newMov=0,t.params.factor=+new Date,t.finished=!1,t.list=[],i=!0),void 0!=s&&void 0!=s.id&&(t.list=[],t.params.page=1,t.params.payed="",t.params.cid=s.id,t.params.key="",t.params.hot=0,t.params.newMov=0,t.params.factor=+new Date,t.finished=!1,i=!0),"cat"==s&&(t.list=[],t.params.page=1,t.params.payed="",t.params.key="",t.params.cid="",t.params.hot=0,t.params.newMov=0,t.params.factor=+new Date,t.finished=!1,i=!0),"new"==s&&(t.list=[],t.params.page=1,t.params.payed="",t.params.key="",t.params.cid="",t.params.hot=0,t.params.newMov=1,t.params.factor=+new Date,t.finished=!1,i=!0),"hot"==s&&(t.list=[],t.params.page=1,t.params.payed="",t.params.key="",t.params.cid="",t.params.hot=1,t.params.newMov=0,t.params.factor=+new Date,t.finished=!1,i=!0),i&&this.$refs.list.scroller.scrollTop){this.$refs.list.scroller.scrollTop=0,console.log("scroll to top");return}console.log("load data",t.params.page,t.params.cid);let r={page:t.params.page,cid:t.params.cid,hot:t.params.hot,key:t.params.key,payed:t.params.payed,factor:t.params.factor};$.ajax({url:"/index/index/vlist",type:"GET",data:t.params,complete:function(e,s){},success:function(e){if(1==(e=aeDsJson(e)).status){if(r.page!==t.params.page||r.cid!==t.params.cid||r.hot!==t.params.hot||r.payed!==t.params.payed||r.key!==t.params.key){t.loading=!1;return}t.total=e.total;let s=e.data;t.params.page>1?(t.list=t.list.concat(s),t.params.page++):(t.list=s,t.params.page=2),t.loading=!1,e.finished&&(t.params.payed?(0===t.list.length?vant.Notify({type:"success",message:"空空如也,赶紧去选择心仪的影片吧!我们即将推送其他精彩内容"}):t.msg="没有更多了",t.finished=!0):(t.finished=!0,t.msg="没有更多了"))}else layer.alert(e.msg)}})},getCat(){let e=this;$.ajax({url:"/index/index/cat",type:"GET",data:e.catParam,complete:function(e,s){},success:function(s){s=aeDsJson(s),e.cat=s.data}})},doSearch(){window.location.href="/index/index/pagecat/?f="+f}}});

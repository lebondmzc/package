var myPlayer,myPlayer2,hlsplayer,title=aeDsJson(en);function injectJS(e,t){if(Array.from(document.scripts).some(t=>t.getAttribute("src")===e)){"function"==typeof t&&t();return}var i=document.createElement("script");i.src=e,document.head.insertBefore(i,document.head.firstElementChild),i.addEventListener("load",e=>{"function"==typeof t&&t()})}function closePlayer(){try{myPlayer&&(myPlayer.dispose(),myPlayer=null)}catch(e){}try{myPlayer2&&(hlsplayer.stopLoad(),hlsplayer.destroy(),hlsplayer=null,myPlayer2.destroy(),myPlayer2=null)}catch(t){}}Vue.config.productionTip=!1,Vue.config.lang="zh-CN";var u=navigator.userAgent,isAndroid=u.indexOf("Android")>-1||u.indexOf("Adr")>-1,playType=isAndroid?2:0,loaded1=!1,loaded2=!1,loading=!1;vues=new Vue({el:"#app",directives:{decodeImg:{inserted(e){var t=e.dataset.src,i=/web.(.*?)$/.exec(t);if(!i||i.length<2){e.src=t;return}let l=i[1];var n=new XMLHttpRequest;n.open("GET",t,!0),n.responseType="",n.onload=function(){if(200==this.status){var t=b64toBlob(this.response,"image/"+l);e.onload=function(){window.URL.revokeObjectURL(e.src)},e.src=window.URL.createObjectURL(t)}},n.onerror=function(e){console.error("get image error")},n.send()}}},data:{title,link1,link2,link:"",online1:"播放器一",online2:"播放器二",playonline1:"网络线路一 √",playonline2:"网络线路二",list:[],cat:[],checked:!1,banner:[],loading:!1,finished:!1,ds_title:"",ds_img:"",ds_duration:0,msg:"没有更多了",params:{action:"list",f,page:1,row:16,encode:1,cid,key,payed:"",recommend:1,kp,factor:+new Date,openid,a,b},catParam:{limit:9,f,encode:1},dialog:{fav:{status:!1,url:"",u},pay:{status:!1,data:[],pay:[]}}},created(){this.debouncedGetList=debounce(this.doGetList,100)},unmounted(){this.debouncedGetList.cancel()},mounted:function(){if("undefined"!=typeof Storage){var e=localStorage.getItem("close");console.log(e)}this.link=this.link1,idx=0,this.changePlayOnlineUrl(idx)},methods:{switchSource(e){this.link=e?this.link2:this.link1,e?(this.playonline1="网络线路一",this.playonline2="网络线路二 √"):(this.playonline1="网络线路一 √",this.playonline2="网络线路二"),Vue.nextTick(()=>{this.changePlayer(playType)})},changePlayOnlineUrl(e){if(0===e&&!1===loaded1){if(loading){setTimeout(()=>{this.changePlayOnlineUrl(e)},500);return}var t=0;injectJS(vjs,()=>{2==++t&&(loaded1=!0,loading=!1)}),injectJS(hls,()=>{2==++t&&(loaded1=!0,loading=!1)}),loading=!0,setTimeout(()=>{this.changePlayOnlineUrl(e)},500);return}playType=e,1===e?(this.online1=this.online1.replace("√",""),this.online2.includes("√")||(this.online2=this.online2+"√")):(this.online2=this.online2.replace("√",""),this.online1.includes("√")||(this.online1=this.online1+"√")),this.changePlayer(e)},changePlayer(e){closePlayer(),Vue.nextTick(()=>{0===e?($("#videoDiv").html('<video id="example-video" playsinline="playsinline" webkit-playsinline="webkit-playsinline" style="width:100%;" height="200" class="video-js vjs-default-skin vjs-big-play-centered" ><source src="" type="application/x-mpegURL" id="target"></video>'),myPlayer=videojs("example-video",{sources:[{src:this.link}],controls:"true"},function(){this.on("play",function(){}),this.on("pause",function(){}),this.on("ended",function(){})})):1==e?($("#videoDiv").html('<div  id="example-video" class="rich_media_content dplayer dplayer-no-danmaku dplayer-mobile dplayer-arrow" style="width: 100%; "></div>'),myPlayer2=new DPlayer({video:{url:this.link,type:"hls"},pluginOptions:{hls:{}}}),myPlayer2=new DPlayer({container:document.getElementById("example-video"),screenshot:!1,autoplay:!0,theme:"#FADFA3",loop:!1,hotkey:!1,preload:!1,video:{url:this.link,type:"customHls",customType:{customHls:function(e,t){(hlsplayer=new Hls).loadSource(e.src),hlsplayer.attachMedia(e)}}}})):($("#videoDiv").html('<div  id="example-video" style="width: 100%; height: 200px;"></div>'),myPlayer=new window.Player({id:"example-video",url:this.link,playsinline:!0,autoplay:!0,closeVideoClick:!0,width:window.innerWidth,height:200}))})},onChange(e){console.log(e)},setClass:e=>"action"+e.flg,try_see(e){vant.Dialog.confirm({title:"试看",message:"试看以结束，请点击打赏观看完整视频",cancelButtonText:"我在选选",confirmButtonText:"打赏观看"}).then(()=>{this.doPay(e)}).catch(()=>{})},doRate:()=>parseInt(9910*Math.random()+90),switchPayment(e){let t=this;var i=t.dialog.pay.pay;for(let l=0;l<i.length;l++){let n=i[l];2==e?(this.$refs.wx.className="",this.$refs.zfb.className="block active",-1==n.url.indexOf("md=2")&&(t.dialog.pay.pay[l].url=n.url+"&md=2")):(this.$refs.wx.className="block active",this.$refs.zfb.className="",-1!=n.url.indexOf("md=2")&&(t.dialog.pay.pay[l].url=n.url.replace("&md=2","")))}},linkTo(e){if(layer.msg("请稍后...",{icon:16,time:1e3}),"1"==dy){document.form.action=e,document.form.submit();return}$.ajax({url:e,type:"GET",success:function(e){$("#pay").html(e)}})},dingbu(){this.$refs.list.scroller.scrollTop=0},doCopyUrl(){var e=new Clipboard("#doCopyValue");e.on("success",function(t){layer.msg("复制成功"),e.destroy()}),e.on("error",function(e){layer.msg("复制失败"),console.log(e)})},doPay(e){console.log(e);let t=this;t.vid=e.id;var i=/web.(.*?)$/.exec(e.img);if(i&&i.length>1){t.ds_img&&(window.URL.revokeObjectURL(t.ds_img),t.ds_img="");var l=i[1],n=new XMLHttpRequest;n.open("GET",e.img,!0),n.responseType="",n.onload=function(){if(200==this.status){var e=b64toBlob(this.response,"image/"+l);t.ds_img=window.URL.createObjectURL(e)}},n.send()}else t.ds_img=e.img;t.ds_title=e.title,t.ds_duration=e.duration;var s=layer.load();$.ajax({url:e.url,type:"GET",data:t.params,complete:function(e,t){layer.close(s)},success:function(i){if(1!=(i=aeDsJson(i)).status){layer.msg("網絡錯誤，請重試!");return}if(1==(e=i.data).pay){if("1"==dy){document.form.action=e.url,document.form.submit();return}window.location.href=e.url;return}pays=[{name:"单片购买  "+e.money+" 元",url:e.url,flg:"dan",money:0}],0==!e.date_fee&&pays.push({name:"包日观看全部 "+e.date_fee+" 元",url:e.date_url,flg:"date_fee",money:0}),0==!e.week_fee&&pays.push({name:"包周观看全部 "+e.week_fee+" 元",url:e.week_url,flg:"week_fee",money:0}),0==!e.month_fee&&pays.push({name:"包月观看全部 "+e.month_fee+" 元",url:e.month_url,flg:"month_fee",money:0}),t.dialog.pay.zfstatus_wx=e.zfstatus_wx,t.dialog.pay.zfstatus_zfb=e.zfstatus_zfb,t.dialog.pay.pay=pays,t.dialog.pay.status=!0,t.dialog.pay.zfstatus_zfb&&t.dialog.pay.zfstatus_wx?(t.dialog.pay.selidx=1,t.dialog.pay.zfstatus=!0):(t.dialog.pay.zfstatus=!1,t.dialog.pay.selidx=2)}})},doGetList(e){let t=this;"pay"==e&&(t.params.page=1,t.params.payed=1,t.list=[]);let i={page:t.params.page,cid:t.params.cid,hot:t.params.hot,key:t.params.key,payed:t.params.payed,factor:t.params.factor};$.ajax({url:"/index/index/vlist",type:"GET",data:t.params,complete:function(e,t){},success:function(e){if(1==(e=aeDsJson(e)).status){if(i.page!==t.params.page){t.loading=!1;return}t.total=e.total;let l=e.data;t.params.page>1?(t.list=t.list.concat(l),t.params.page++):(t.list=l,t.params.page=2),t.loading=!1,t.list.length==e.total&&(t.params.payed?(0===t.list.length?vant.Notify({type:"success",message:"空空如也,赶紧去选择心仪的影片吧!我们即将推送其他精彩内容"}):t.msg="没有更多了",t.finished=!0):(t.finished=!0,t.msg="没有更多了"))}else layer.alert(e.msg)}})},doSearch(){window.location.href="/user.php?uid=1&type=channel"},goHome(){window.location.replace(home)},guanbi(){let e=this;"undefined"!=typeof Storage?localStorage.setItem("close",e.checked):console.log("不支持本地存储"),console.log(e.checked),e.dialog.fav.status=!1},doFav(){let e=this;"undefined"!=typeof Storage&&"true"==localStorage.getItem("close")&&(e.checked=!0),e.dialog.fav.url=d,console.log(e.dialog.fav.url),e.dialog.fav.status=!0}}}),$(document).ready(function(){$("#searchSubmit1").click(function(){var e=$("#keys").val();location.href="/index/index/pagecat?f="+f+"&type=search&keyword="+e})});
